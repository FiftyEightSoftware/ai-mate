# Render Backend Troubleshooting Guide

**Current Issue:** Backend returns 502 Bad Gateway  
**Expected:** Should return 200 OK with JSON health data

---

## ðŸ” How to Check Render Logs

### Step 1: Access Logs
1. Go to: https://dashboard.render.com
2. Click on **"ai-mate-api"** service
3. Click **"Logs"** tab at the top

### Step 2: Look for These Key Messages

**âœ… GOOD Signs (Deployment Working):**
```
==> Building...
==> Downloading buildpack...
Step 1/X : FROM mcr.microsoft.com/dotnet/sdk:8.0
==> Successfully built
==> Pushing image...
==> Starting service...
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://0.0.0.0:10000
Application started. Press Ctrl+C to shut down.
```

**âŒ BAD Signs (Errors to Fix):**

1. **Wrong .NET Version:**
```
Error: Unable to find image 'mcr.microsoft.com/dotnet/sdk:9.0'
```
â†’ **Already fixed** (changed to 8.0)

2. **Build Failed:**
```
Error: The project doesn't exist
MSBuild version X for .NET Y
error CS1061: Type does not contain definition
```
â†’ Code compilation error

3. **Port Binding Error:**
```
Unable to bind to http://0.0.0.0:5000
Address already in use
```
â†’ Port configuration issue

4. **Database Error:**
```
SQLite Error 1: 'no such table'
SQLite Error: unable to open database
```
â†’ Database initialization issue

5. **Redis Connection Error:**
```
Redis connection failed
StackExchange.Redis: Connection refused
```
â†’ Redis not properly configured

6. **Application Crash:**
```
Unhandled exception
Process exited with code 1
Application is shutting down
```
â†’ Runtime error

---

## ðŸ› ï¸ Common Fixes

### Issue 1: Port Configuration
**Problem:** App not listening on Render's PORT  
**Solution:** Verify in logs that it shows:
```
Now listening on: http://0.0.0.0:10000
```
(Port 10000 is Render's default, set via PORT env var)

**Our Dockerfile has:**
```dockerfile
ENV ASPNETCORE_URLS=http://0.0.0.0:${PORT:-5000}
```
This should work âœ…

### Issue 2: Database Path
**Problem:** SQLite can't write to filesystem  
**Check:** Logs should show:
```
[INF] Running database migrations...
[INF] Seeding database...
```

**If Missing:** Database might not be initialized

### Issue 3: Redis Connection
**Problem:** REDIS_CONNECTION not set or invalid  
**Check in Render Dashboard:**
- Environment â†’ `REDIS_CONNECTION` should show value from Redis service

### Issue 4: Missing Environment Variables
**Required Variables:**
- `ASPNETCORE_ENVIRONMENT` = Production
- `ASPNETCORE_URLS` = Set by Dockerfile
- `AIMATE_DB_PASSWORD` = Auto-generated by Render
- `REDIS_CONNECTION` = From Redis service
- `FRONTEND_ORIGINS` = Your Netlify URL

---

## ðŸ“‹ What to Look For in Logs (In Order)

### 1. Build Phase
```
==> Building...
==> FROM mcr.microsoft.com/dotnet/sdk:8.0
==> WORKDIR /src
==> RUN dotnet restore
==> RUN dotnet publish
==> Successfully built
```

### 2. Image Push
```
==> Pushing image...
==> Successfully pushed
```

### 3. Deployment
```
==> Starting service...
==> Deploy successful
```

### 4. Application Startup
```
info: Microsoft.Hosting.Lifetime[0]
      Application started
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://0.0.0.0:10000
```

### 5. Database Initialization
```
[INF] Running database migrations...
[INF] Migration: InitialCreate
[INF] Database migrations complete
[INF] Seeding database...
[INF] Seeded X invoices and Y jobs
```

### 6. Health Check
```
[INF] Health check: Healthy
```

---

## ðŸš¨ If Build Keeps Failing

### Quick Fix: Manual Redeploy
1. In Render dashboard â†’ ai-mate-api
2. Click **"Manual Deploy"** â†’ **"Clear build cache & deploy"**
3. This forces a clean rebuild

### Alternative: Check Service Status
Look at the status indicator:
- ðŸŸ¢ **Live** = Healthy and running
- ðŸŸ¡ **Building** = Still deploying
- ðŸŸ¡ **Deploying** = Starting up
- ðŸ”´ **Build Failed** = Check logs for error
- ðŸ”´ **Unhealthy** = App started but health check failed

---

## ðŸ”„ Current Deployment Timeline

**15:56** - Initial deploy (502)  
**15:58** - Fixed .NET version (9.0 â†’ 8.0)  
**16:00** - Pushed fix to GitHub  
**16:01** - Render started rebuild  
**16:48** - Still building/deploying (current)

**Expected:** Should be live by **16:50-17:00** (10 minutes from fix)

---

## âœ… When Backend is Live

You'll see in logs:
```
Now listening on: http://0.0.0.0:10000
Application started
```

And the health endpoint will return:
```json
{
  "ok": true,
  "status": "Healthy",
  "checks": [...]
}
```

Test with:
```bash
curl https://ai-mate-api.onrender.com/api/health
```

Should return **HTTP 200** (not 502)

---

## ðŸ“± Quick Status Check

Run this in your terminal:
```bash
# Check status
curl -s -o /dev/null -w "Status: %{http_code}\n" https://ai-mate-api.onrender.com/api/health

# If 200, test full response
curl -s https://ai-mate-api.onrender.com/api/health | jq '.'
```

---

## ðŸ†˜ Still Not Working After 15 Minutes?

Possible issues:
1. **Render having platform issues** â†’ Check https://status.render.com
2. **Build genuinely failing** â†’ Need to fix code and redeploy
3. **Service suspended** â†’ Free tier limitation
4. **Health check timeout** â†’ App too slow to start

**Next Steps:**
1. Check Render logs for specific error
2. Share error message here for help
3. Consider checking Render community forums

---

**Dashboard:** https://dashboard.render.com  
**Status:** https://status.render.com  
**Docs:** https://render.com/docs
